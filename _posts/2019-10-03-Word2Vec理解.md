---
layout: post
title: "word2vecç†è§£"
date: "2019-10-03"
description: "ä»‹ç»CBOWå’Œskip-gramä¸¤ç§ç±»åž‹çš„Word2Vecä»¥åŠä¼˜åŒ–æ–¹æ³•"
tag: nlp
---

[word2vec](https://github.com/tmikolov/word2vec)æ˜¯googleäºŽ2013å¹´æŽ¨å‡ºçš„ä¸€ä¸ªnlpå·¥å…·ï¼Œå®ƒèƒ½å¤Ÿè®­ç»ƒå¾—åˆ°æ¯ä¸ªè¯çš„ç¨ å¯†å‘é‡ã€‚è¯¥å‘é‡å¯ä»¥ç”¨äºŽåº¦é‡è¯ä¸Žè¯ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€å…³è”æ€§ã€‚word2vecåŒ…å«ä¸¤ç§æ¨¡åž‹ï¼Œåˆ†åˆ«æ˜¯CBOW(continuous bag of words)å’ŒSkip-Gramï¼›ä¸¤ç§è®­ç»ƒæ–¹å¼ï¼Œåˆ†åˆ«æ˜¯hierachical softmaxå’Œnegrative samplingã€‚é’ˆå¯¹word2vecï¼Œæœ¬æ–‡å°†æŒ‰ä»¥ä¸‹å‡ ç‚¹åšä»‹ç»(ç”±äºŽçº¯ç²¹æ˜¯ä¸ªäººè®°å½•çŸ¥è¯†ç‚¹ï¼Œæœ‰äº›æ²¡è¡¨è¿°æ¸…æ¥šçš„åœ°æ–¹è¿˜æœ›æŠ±æ­‰)ï¼š
* word2vecæ¦‚è¿°
* CBOWæ¨¡åž‹
* Skip-Gramæ¨¡åž‹
* hierachical softmaxè®­ç»ƒæ–¹æ³•
* negative samplingè®­ç»ƒæ–¹æ³•
  
## word2vecæ¦‚è¿°
æ–‡æœ¬ä¸­å¦‚ä½•ç”¨ä¸€ä¸ªå‘é‡åŽ»è¡¨ç¤ºä¸€ä¸ªå•è¯ï¼Œæ—©æœŸæœ€ç®€å•ç›´æŽ¥çš„æ–¹å¼æ˜¯ä½¿ç”¨one-hot representationçš„æ–¹å¼ï¼Œå¯¹æ¯ä¸ªå•è¯æž„å»ºä¸€ä¸ªä¸Žè¯å…¸å¤§å°ä¸€è‡´çš„å‘é‡ï¼Œå…¶ä¸­ä¸º1å¤„çš„ç´¢å¼•è¡¨ç¤ºè¯¥å•è¯çš„ä½ç½®ã€‚è¿™ç§æ–¹å¼ï¼Œä¸€æ–¹é¢è¯å‘é‡çš„é•¿åº¦ä¸Žè¯å…¸å¤§å°æœ‰å…³ï¼Œå­˜å‚¨ç©ºé—´è¿‡äºŽå†—ä½™ï¼›å¦ä¸€æ–¹é¢å‘é‡ä¹‹é—´çš„è¿ç®—ç»“æžœæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚

Distributed representationå¯ä»¥è§£å†³one-hot representationçš„ä¸Šè¿°é—®é¢˜ã€‚å®ƒçš„æ€è·¯æ˜¯é€šè¿‡è®­ç»ƒï¼Œå°†è¯æ˜ å°„æˆä¸€ä¸ªç¨ å¯†å‘é‡ã€‚åˆ©ç”¨è¿™äº›è®­ç»ƒå¾—åˆ°çš„è¯å‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥è¾ƒå®¹æ˜“çš„åˆ†æžè¯ä¹‹é—´çš„å…³ç³»ï¼Œæ¯”å¦‚ä¸€ä¸ªæœ‰è¶£çš„ç»“æžœï¼š

$$\vec{King} - \vec{Man} + \vec{Women} = \vec{Queen}$$


word2vecçš„ç½‘ç»œç»“æž„ç›¸æ¯”äºŽå®ƒçš„å‰è¾ˆNNLM(neural network language model)æ¯”è¾ƒç®€å•ã€‚NNLMç½‘ç»œç»“æž„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![NNLMç½‘ç»œç»“æž„ç¤ºæ„å›¾](https://images2015.cnblogs.com/blog/939075/201607/939075-20160719201106732-581954491.png)

è¯¥æ¨¡åž‹å¯ä»¥æ‹†è§£æˆä¸¤éƒ¨åˆ†ç†è§£ï¼š
1. çº¿æ€§çš„Embeddingå±‚ã€‚å°†è¾“å…¥çš„N-1ä¸ªone-hotè¯å‘é‡é€šè¿‡å¤§å°ä¸º(D,V)çš„çŸ©é˜µCæ˜ å°„ä¸ºN-1ä¸ªåˆ†å¸ƒå¼çš„è¯å‘é‡ï¼ŒDä¸ºEmbeddingå¤§å°ï¼ŒVä¸ºè¯å…¸å¤§å°ã€‚
2. ç®€å•çš„å‰å‘ç½‘ç»œã€‚åŒ…å«tanhéšè—å±‚å’Œsoftmaxè¾“å‡ºå±‚.

word2vecç›¸æ¯”äºŽNNLMåšäº†å¦‚ä¸‹æ”¹é€ ï¼š
1. åŽ»é™¤äº†NNLMçš„tanhéšè—å±‚ï¼Œç›´æŽ¥ç”±embeddingå±‚è¿žæŽ¥åˆ°softmaxå±‚ï¼›
2. å¿½ç•¥ä¸Šä¸‹æ–‡çŽ¯å¢ƒçš„åºåˆ—ä¿¡æ¯ï¼šè¾“å…¥çš„æ‰€æœ‰è¯å‘é‡æ±‡æ€»åˆ°ä¸€ä¸ªEmbedding layerï¼›
3. å°†ä¸­å¿ƒè¯çš„ä¸‹æ–‡çº³å…¥ä¸Šä¸‹æ–‡çŽ¯å¢ƒã€‚

## CBOWæ¨¡åž‹
CBOWæ¨¡åž‹æ˜¯word2vecç®—æ³•çš„ç¬¬ä¸€ä¸ªæ¨¡åž‹ï¼Œå…¶ç½‘ç»œç»“æžœå¦‚ä¸‹å›¾ï¼š

![CBOWç½‘ç»œç»“æž„ç¤ºæ„å›¾](https://images2015.cnblogs.com/blog/939075/201607/939075-20160719201512435-160028706.png)

ä»Žæ•°å­¦ä¸Šçœ‹ï¼ŒCBOWæ¨¡åž‹ç­‰ä»·äºŽä¸€ä¸ªè¯è¢‹æ¨¡åž‹çš„å‘é‡ä¹˜ä»¥ä¸€ä¸ªEmbeddingçŸ©é˜µï¼Œä»Žè€Œå¾—åˆ°ä¸€ä¸ªè¿žç»­çš„embeddingå‘é‡ã€‚å…¶æœ¬è´¨æ˜¯ç”±ä¸­å¿ƒè¯çš„ä¸Šä¸‹çª—å£2cä¸ªè¯çš„ç‰¹å¾å‘é‡åŽ»ä¼°è®¡ä¸­å¿ƒè¯ï¼Œæ‰€ä»¥CBOWæ¨¡åž‹çš„è®­ç»ƒè¾“å…¥æ˜¯æŸä¸ªè¯çš„ä¸Šä¸‹ç›¸å…³è¯å¯¹åº”çš„è¯å‘é‡ï¼Œè¾“å‡ºæ˜¯è¿™ä¸ªè¯çš„è¯å‘é‡ã€‚

## Skip-Gramæ¨¡åž‹
ä¸ŽCBOWæ¨¡åž‹ç›¸åï¼ŒSkip-Gramæ¨¡åž‹æ˜¯ç”¨ä¸­å¿ƒè¯åŽ»ä¼°è®¡ä¸Šä¸‹æ–‡çª—å£2cä¸ªè¯ï¼Œå…¶ç½‘ç»œç»“æžœå¦‚ä¸‹å›¾ï¼š

![Skip-Gramç½‘ç»œç»“æž„ç¤ºæ„å›¾](https://images2015.cnblogs.com/blog/939075/201607/939075-20160719201532560-2134123571.png)

## hierachical softmaxè®­ç»ƒæ–¹æ³•
ç”±äºŽè¯å…¸å¤§å°å¾ˆå¤§ï¼Œåœ¨æœ€åŽçš„softmaxå±‚é€šå¸¸ä¼šæœ‰å¤§é‡çš„è®¡ç®—ã€‚ä¸ºäº†é¿å…è®¡ç®—æ‰€æœ‰è¯çš„softmaxæ¦‚çŽ‡ï¼Œword2vecé‡‡ç”¨äº†éœå¤«æ›¼æ ‘æ¥æ›¿ä»£éšè—å±‚åˆ°softmaxå±‚çš„æ˜ å°„ã€‚è¯å…¸çš„éœå¤«æ›¼æ ‘æž„å»ºï¼Œä¸Žä¸€èˆ¬çš„éœå¤«æ›¼æ ‘æž„å»ºä¸€æ ·ï¼Œåªä¸è¿‡å¶å­èŠ‚ç‚¹çš„æƒé‡ä¸ºå¶èŠ‚ç‚¹è¯çš„é¢‘çŽ‡ã€‚

æœ‰äº†éœå¤«æ›¼æ ‘ï¼Œåœ¨è®¡ç®—softmaxæ¦‚çŽ‡è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ²¿ç€æ ‘å½¢ç»“æž„èµ°å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥æ²¿ç€æ ¹èŠ‚ç‚¹å¯¼åˆ°å¶å­èŠ‚ç‚¹è¯w2ã€‚

![éœå¤«æ›¼æ ‘](https://images2017.cnblogs.com/blog/1042406/201707/1042406-20170727105752968-819608237.png)

åœ¨å»¶éœå¤«æ›¼æ ‘åˆ°è¾¾å¶å­èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œè¿™é‡Œé‡‡ç”¨äº†äºŒå…ƒé€»è¾‘å›žå½’çš„æ–¹æ³•ï¼Œå¦‚æžœæ˜¯å·¦å­æ ‘åˆ™ä¸ºè´Ÿç±»(0)ï¼Œæ²¿ç€å³å­æ ‘åˆ™æ˜¯æ­£ç±»(1)ï¼Œæ¦‚çŽ‡ä¼°è®¡å…¬å¼ä¸ºsigmoidå‡½æ•°ï¼Œå³
$$ P(+)=\frac{1}{1+e^{-x^T\theta}} $$
å…¶ä¸­$x$ä¸ºå†…éƒ¨èŠ‚ç‚¹çš„å‘é‡ï¼Œ$\theta$æ˜¯æˆ‘ä»¬éœ€è¦è®­ç»ƒçš„æ¨¡åž‹å‚æ•°ï¼Œè®­ç»ƒç›®æ ‡æ˜¯æˆ‘ä»¬å¸Œæœ›è·¯å¾„èŠ‚ç‚¹çš„æ¦‚çŽ‡ä¹˜ç§¯æœ€å¤§ã€‚

## negative samplingè®­ç»ƒæ–¹æ³•
å°½ç®¡hierachical softmaxç›¸æ¯”ä¸ŽåŽŸå§‹çš„softmaxåœ¨è®¡ç®—æ•ˆçŽ‡ä¸Šæœ‰è¾ƒå¤§æ”¹è¿›ï¼Œä½†æ˜¯åœ¨é¢å¯¹ç”Ÿåƒ»è¯æ—¶ï¼Œåœ¨éœå¤«æ›¼æ ‘çš„è·¯å¾„å¾ˆé•¿ï¼Œå¯¼è‡´æ¨¡åž‹è®­ç»ƒè¾ƒæ…¢ï¼Œæ‰€ä»¥negative samplingè®­ç»ƒæ–¹æ³•æ‘’å¼ƒäº†éœå¤«æ›¼æ ‘ã€‚

å‡è®¾ä¸­å¿ƒè¯wï¼Œä¸Šä¸‹æ–‡çª—å£å…±2cä¸ªè¯ï¼Œè®°ä¸ºcontext(w)ã€‚è¿™é‡Œä¸­å¿ƒè¯wä¸Žcontext(w)æž„æˆä¸€ä¸ªæ­£ä¾‹ã€‚æ—¢ç„¶æ˜¯è´Ÿé‡‡æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬å°†é‡‡æ ·å¾—åˆ°negä¸ªä¸Žwä¸åŒçš„ä¸­å¿ƒè¯ï¼Œå¦‚æ­¤å¾—åˆ°äº†1+negä¸ªæ ·æœ¬ã€‚è¿™ä¸ªè¿‡ç¨‹å¼•å‡ºäº†ä¸¤ä¸ªé—®é¢˜ï¼š
1. å¦‚ä½•è¿›è¡Œè´Ÿé‡‡æ ·ï¼Ÿ
2. é’ˆå¯¹1+negä¸ªæ ·æœ¬å¦‚ä½•è®­ç»ƒï¼Ÿ

### è´Ÿé‡‡æ ·æ–¹æ³•
å¦‚æžœè¯æ±‡è¡¨çš„å¤§å°ä¸ºð‘‰,é‚£ä¹ˆæˆ‘ä»¬å°±å°†ä¸€æ®µé•¿åº¦ä¸º1çš„çº¿æ®µåˆ†æˆð‘‰ä»½ï¼Œæ¯ä»½å¯¹åº”è¯æ±‡è¡¨ä¸­çš„ä¸€ä¸ªè¯ã€‚å½“ç„¶æ¯ä¸ªè¯å¯¹åº”çš„çº¿æ®µé•¿åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œé«˜é¢‘è¯å¯¹åº”çš„çº¿æ®µé•¿ï¼Œä½Žé¢‘è¯å¯¹åº”çš„çº¿æ®µçŸ­ã€‚æ¯ä¸ªè¯ð‘¤çš„çº¿æ®µé•¿åº¦ç”±ä¸‹å¼å†³å®šï¼š
$$ len(w) = \frac{count(w)^{\frac{3}{4}}}{\sum{count(u)^{\frac{3}{4}}}} $$
æ­¤å¤–ï¼Œåœ¨é‡‡æ ·å‰æˆ‘ä»¬å°†è¿™æ®µé•¿åº¦ä¸º1çš„çº¿æ®µåˆ’åˆ†ä¸ºMç­‰åˆ†ï¼Œè¿™é‡ŒM>>V,ä¿è¯æ¯ä¸ªè¯å¯¹åº”çš„çº¿æ®µéƒ½ä¼šåˆ’åˆ†æˆå¯¹åº”çš„å°å—ã€‚è€ŒMä»½ä¸­çš„æ¯ä¸€ä»½éƒ½ä¼šè½åœ¨æŸä¸€ä¸ªè¯å¯¹åº”çš„çº¿æ®µä¸Šã€‚åœ¨é‡‡æ ·çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦ä»Žð‘€ä¸ªä½ç½®ä¸­é‡‡æ ·å‡ºð‘›ð‘’ð‘”ä¸ªä½ç½®å°±è¡Œï¼Œæ­¤æ—¶é‡‡æ ·åˆ°çš„æ¯ä¸€ä¸ªä½ç½®å¯¹åº”åˆ°çš„çº¿æ®µæ‰€å±žçš„è¯å°±æ˜¯æˆ‘ä»¬çš„è´Ÿä¾‹è¯ã€‚
![negative sampling](https://images2017.cnblogs.com/blog/1042406/201707/1042406-20170728152731711-1136354166.png)

## å‚è€ƒå¼•ç”¨
> 1. [word2vecåŽŸç†(ä¸€) CBOWä¸ŽSkip-Gramæ¨¡åž‹åŸºç¡€](https://www.cnblogs.com/pinard/p/7160330.html)
> 2. [word2vecåŽŸç†(äºŒ) åŸºäºŽHierarchical Softmaxçš„æ¨¡åž‹](https://www.cnblogs.com/pinard/p/7243513.html)
> 3. [word2vecåŽŸç†(ä¸‰) åŸºäºŽNegative Samplingçš„æ¨¡åž‹](https://www.cnblogs.com/pinard/p/7249903.html)
> 4. [Word2Vecè¯¦è§£](https://www.cnblogs.com/guoyaohua/p/9240336.html)